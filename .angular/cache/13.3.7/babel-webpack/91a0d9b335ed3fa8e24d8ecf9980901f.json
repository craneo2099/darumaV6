{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport { FormGroup, FormControl, Validators } from '@angular/forms';\nimport * as CryptoJS from 'crypto-js';\nimport { PasswordValidatorService } from 'src/app/providers/password-validator/password-validator.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/providers/daruma-service/daruma.service\";\nimport * as i2 from \"@ionic/angular\";\nimport * as i3 from \"@angular/forms\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"@angular/common\";\n\nfunction CambioPassPage_ng_container_29_ion_item_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-item\")(1, \"ion-text\", 29)(2, \"p\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const validation_r5 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(validation_r5.message);\n  }\n}\n\nfunction CambioPassPage_ng_container_29_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, CambioPassPage_ng_container_29_ion_item_1_Template, 4, 1, \"ion-item\", 28);\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const validation_r5 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.cambioPassForm.get(\"passwordO\").hasError(validation_r5.type) && (ctx_r0.cambioPassForm.get(\"passwordO\").dirty || ctx_r0.cambioPassForm.get(\"passwordO\").touched));\n  }\n}\n\nfunction CambioPassPage_ng_container_36_ion_item_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-item\")(1, \"ion-text\", 29)(2, \"p\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const validation_r8 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(validation_r8.message);\n  }\n}\n\nfunction CambioPassPage_ng_container_36_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0, 30);\n    i0.ɵɵtemplate(1, CambioPassPage_ng_container_36_ion_item_1_Template, 4, 1, \"ion-item\", 28);\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const validation_r8 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.cambioPassForm.get(\"matching_passwords\").get(\"passwordN\").hasError(validation_r8.type) && (ctx_r1.cambioPassForm.get(\"matching_passwords\").get(\"passwordN\").dirty || ctx_r1.cambioPassForm.get(\"matching_passwords\").get(\"passwordN\").touched));\n  }\n}\n\nfunction CambioPassPage_ng_container_45_ion_item_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-item\")(1, \"ion-text\", 29)(2, \"p\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const validation_r11 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(validation_r11.message);\n  }\n}\n\nfunction CambioPassPage_ng_container_45_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, CambioPassPage_ng_container_45_ion_item_1_Template, 4, 1, \"ion-item\", 28);\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const validation_r11 = ctx.$implicit;\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.cambioPassForm.get(\"matching_passwords\").get(\"passwordNC\").hasError(validation_r11.type) && (ctx_r2.cambioPassForm.get(\"matching_passwords\").get(\"passwordNC\").dirty || ctx_r2.cambioPassForm.get(\"matching_passwords\").get(\"passwordNC\").touched));\n  }\n}\n\nfunction CambioPassPage_ng_container_46_ion_item_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-item\")(1, \"ion-text\", 29)(2, \"p\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const validation_r14 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(validation_r14.message);\n  }\n}\n\nfunction CambioPassPage_ng_container_46_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, CambioPassPage_ng_container_46_ion_item_1_Template, 4, 1, \"ion-item\", 28);\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const validation_r14 = ctx.$implicit;\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r3.cambioPassForm.get(\"matching_passwords\").hasError(validation_r14.type) && (ctx_r3.cambioPassForm.get(\"matching_passwords\").get(\"passwordNC\").dirty || ctx_r3.cambioPassForm.get(\"matching_passwords\").get(\"passwordNC\").touched));\n  }\n}\n\nfunction CambioPassPage_ion_footer_52_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-footer\", 31)(1, \"ion-grid\", 3)(2, \"ion-row\")(3, \"ion-col\", 32)(4, \"div\", 33)(5, \"small\");\n    i0.ɵɵtext(6, \"Powered by \");\n    i0.ɵɵelementStart(7, \"b\");\n    i0.ɵɵtext(8, \"Devstar Novatech.\");\n    i0.ɵɵelementEnd()()()()()()();\n  }\n}\n\nexport let CambioPassPage = /*#__PURE__*/(() => {\n  class CambioPassPage {\n    constructor(ds, alertCtrl, ngZone, loadingCtrl, formBuilder, route, router) {\n      this.ds = ds;\n      this.alertCtrl = alertCtrl;\n      this.ngZone = ngZone;\n      this.loadingCtrl = loadingCtrl;\n      this.formBuilder = formBuilder;\n      this.route = route;\n      this.router = router;\n      this.isKeyboardHide = true;\n      this.validation_messages = {\n        'passwordN': [{\n          type: 'required',\n          message: 'Campo Requerido'\n        }, {\n          type: 'minlength',\n          message: 'M\\u00EDnimo 5 caracteres'\n        }, {\n          type: 'maxlength',\n          message: 'M\\u00E1ximo 20 caracteres'\n        }],\n        'passwordNC': [{\n          type: 'required',\n          message: 'Campo Requerido'\n        }],\n        'matching_passwords': [{\n          type: 'areEqual',\n          message: 'No coincide la contrase\\u00F1a'\n        }],\n        'passwordO': [{\n          type: 'required',\n          message: 'Campo Requerido'\n        }]\n      }; // this.token =     navParams.get(\"token\");\n\n      this.route.queryParams.subscribe(params => {\n        this.data = this.router.getCurrentNavigation().extras.state;\n        console.log(\"paramsDETAIL\", this.data.token);\n        this.token = this.data.token;\n      });\n      this.matching_passwords_group = new FormGroup({\n        passwordN: new FormControl('', Validators.compose([Validators.minLength(5), Validators.required, Validators.maxLength(20)])),\n        passwordNC: new FormControl('', Validators.required)\n      }, formGroup => {\n        return PasswordValidatorService.areEqual(formGroup);\n      });\n      this.cambioPassForm = this.formBuilder.group({\n        passwordO: new FormControl('', Validators.compose([Validators.required])),\n        matching_passwords: this.matching_passwords_group\n      });\n    }\n\n    cambiarPass() {\n      return __awaiter(this, void 0, void 0, function* () {\n        this.loader = yield this.loadingCtrl.create();\n        yield this.loader.present(); // console.log(\"Cambio contraseña\");\n\n        if (this.cambioPassForm.get(\"passwordO\").hasError('required') || this.cambioPassForm.get('matching_passwords').get('passwordN').hasError('required') || this.cambioPassForm.get('matching_passwords').get('passwordNC').hasError('required')) {\n          // console.log(\"Completa todos los campos!!!\");\n          var texto = \"Completa todos los campos!!!\";\n          yield this.loader.dismiss();\n          this.doAlert(\"Error!\", texto, \"\");\n        } else {\n          if (this.cambioPassForm.get('passwordO').errors && this.cambioPassForm.get('passwordO').dirty) {\n            yield this.loader.dismiss();\n            this.doAlert(\"Error!!!\", \"Escribe el correo correctamente\", \"\");\n          } else if (this.cambioPassForm.get('matching_passwords').get('passwordN').hasError('minlength')) {\n            yield this.loader.dismiss();\n            this.doAlert(\"Error!!!\", \"Contrase\\u00F1a: \" + this.validation_messages.passwordN[1][\"message\"], \"\");\n          } else if (this.cambioPassForm.get('matching_passwords').get('passwordN').hasError('maxlength')) {\n            yield this.loader.dismiss();\n            this.doAlert(\"Error!!!\", \"Contrase\\u00F1a: \" + this.validation_messages.passwordN[2][\"message\"], \"\");\n          } else if (this.cambioPassForm.get('matching_passwords').hasError(\"areEqual\")) {\n            yield this.loader.dismiss();\n            this.doAlert(\"Error!!!\", \"Contrase\\u00F1a: \" + this.validation_messages.matching_passwords[0][\"message\"], \"\");\n          } else {\n            if (this.cambioPassForm.value.matching_passwords.passwordN == this.cambioPassForm.value.matching_passwords.passwordNC) {\n              // console.log(this.usuario, this.token);\n              let sha256O = CryptoJS.SHA256(this.cambioPassForm.value.passwordO);\n              let sha256N = CryptoJS.SHA256(this.cambioPassForm.value.matching_passwords.passwordN);\n              let datosCambioPass = {\n                \"usuario\": this.usuario,\n                \"oldPass\": sha256O.toString(CryptoJS.enc.Hex),\n                \"newPass\": sha256N.toString(CryptoJS.enc.Hex)\n              };\n              this.ds.actualizarPass(datosCambioPass, this.token).subscribe(res => __awaiter(this, void 0, void 0, function* () {\n                if (res[\"response\"] == true) {\n                  // console.log(\"actualizado\", res);\n                  let sub = \"¡Contrase\\u00F1a actualizada!\";\n                  let mes = \"Inicia sesi\\u00F3n nuevamente\";\n                  yield this.loader.dismiss();\n                  this.doAlertConfirm(\"Exito!\", sub, mes);\n                } else {\n                  // console.log(\"pass Incorrecto\", res);\n                  yield this.loader.dismiss();\n                  this.doAlert(\"Error!!!\", \"Contrase\\u00F1a incorrecta\", \"\");\n                }\n              }), error => {\n                console.error(\"Error actualizarPass\", error);\n              });\n            }\n          }\n        }\n      });\n    }\n\n    obtieneUsuario() {\n      this.ds.getUser().then(user => {\n        this.usuario = user;\n      }).catch(e => console.log('Error getUser', e));\n    }\n\n    doAlert(titulo, sub, texto) {\n      return __awaiter(this, void 0, void 0, function* () {\n        let alert = this.alertCtrl.create({\n          header: titulo,\n          subHeader: sub,\n          message: texto,\n          backdropDismiss: false,\n          buttons: ['Ok']\n        });\n        (yield alert).present();\n      });\n    }\n\n    doAlertConfirm(titulo, sub, texto) {\n      return __awaiter(this, void 0, void 0, function* () {\n        let alert = this.alertCtrl.create({\n          header: titulo,\n          subHeader: sub,\n          message: texto,\n          backdropDismiss: false,\n          buttons: [{\n            text: 'Ok',\n            handler: () => {\n              this.ds.borraToken().then(token => {\n                console.log(\"tokenBorrado \");\n                this.router.navigate(['inicio-login']);\n              }).catch(e => console.log('Error borraToken', e));\n            }\n          }]\n        });\n        (yield alert).present();\n      });\n    }\n\n    ionViewWillEnter() {\n      window.addEventListener('keyboardWillHide', () => {\n        this.ngZone.run(() => {\n          this.isKeyboardHide = true;\n        }); // console.log('keyboard will hide', this.isKeyboardHide);\n      });\n      window.addEventListener('keyboardWillShow', e => {\n        this.ngZone.run(() => {\n          this.isKeyboardHide = false;\n        }); // console.log('keyboard will show with height', this.isKeyboardHide);\n      });\n    }\n\n    ngOnInit() {\n      this.obtieneUsuario();\n    }\n\n  }\n\n  CambioPassPage.ɵfac = function CambioPassPage_Factory(t) {\n    return new (t || CambioPassPage)(i0.ɵɵdirectiveInject(i1.DarumaService), i0.ɵɵdirectiveInject(i2.AlertController), i0.ɵɵdirectiveInject(i0.NgZone), i0.ɵɵdirectiveInject(i2.LoadingController), i0.ɵɵdirectiveInject(i3.FormBuilder), i0.ɵɵdirectiveInject(i4.ActivatedRoute), i0.ɵɵdirectiveInject(i4.Router));\n  };\n\n  CambioPassPage.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: CambioPassPage,\n    selectors: [[\"app-cambio-pass\"]],\n    decls: 53,\n    vars: 6,\n    consts: [[\"slot\", \"start\"], [1, \"colorFondo\", \"ion-padding-vertical\"], [\"fixed\", \"true\", 1, \"ion-no-padding\", 3, \"formGroup\", \"ngSubmit\"], [1, \"ion-no-padding\"], [1, \"ion-justify-content-center\", \"ion-padding-bottom\"], [\"src\", \"../../assets/imgs/logoKoiHT2.png\", \"alt\", \"logoKoiHT2\", 1, \"imgRed2\", \"noMostrarG\"], [\"src\", \"../../assets/imgs/logoKoiHT2.png\", \"alt\", \"logoKoiHT2\", 1, \"imgRed\", \"noMostrarChico\"], [1, \"ion-justify-content-center\", \"ion-padding-bottom\", \"centrarG\"], [\"size\", \"12\", \"size-md\", \"6\"], [\"color\", \"rosa\"], [1, \"ion-padding-start\", \"ion-no-margin\"], [1, \"ion-justify-content-center\"], [\"size\", \"12\", \"size-md\", \"6\", 1, \"ion-no-padding\"], [1, \"ion-no-margin\", \"ion-no-padding\"], [\"position\", \"floating\", \"color\", \"primary\"], [\"name\", \"key\"], [\"color\", \"gris\"], [\"type\", \"password\", \"name\", \"passwordO\", \"clearInput\", \"true\", \"formControlName\", \"passwordO\", \"required\", \"\"], [4, \"ngFor\", \"ngForOf\"], [\"formGroupName\", \"matching_passwords\"], [\"type\", \"password\", \"name\", \"passwordN\", \"clearInput\", \"true\", \"formControlName\", \"passwordN\", \"required\", \"\"], [\"ion-col\", \"\", \"col-12\", \"\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"password\", \"name\", \"passwordNC\", \"clearInput\", \"true\", \"formControlName\", \"passwordNC\", \"required\", \"\"], [1, \"ion-justify-content-center\", \"ion-padding-horizontal\", \"ion-padding-top\"], [\"size\", \"12\", \"size-md\", \"6\", 1, \"colorFondo\"], [\"type\", \"submit\", \"color\", \"verde\", \"expand\", \"block\", 1, \"\"], [\"slot\", \"start\", \"name\", \"create\"], [\"class\", \"footerColor ion-no-border\", 4, \"ngIf\"], [4, \"ngIf\"], [\"color\", \"danger\"], [\"ion-col\", \"\", \"col-12\", \"\"], [1, \"footerColor\", \"ion-no-border\"], [\"size\", \"12\"], [1, \"ion-text-center\"]],\n    template: function CambioPassPage_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"ion-header\")(1, \"ion-toolbar\")(2, \"ion-buttons\", 0);\n        i0.ɵɵelement(3, \"ion-back-button\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"ion-title\");\n        i0.ɵɵtext(5, \"Cambiar Contrase\\u00F1a\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(6, \"ion-content\", 1)(7, \"form\", 2);\n        i0.ɵɵlistener(\"ngSubmit\", function CambioPassPage_Template_form_ngSubmit_7_listener() {\n          return ctx.cambiarPass();\n        });\n        i0.ɵɵelementStart(8, \"ion-grid\", 3)(9, \"ion-row\", 4);\n        i0.ɵɵelement(10, \"img\", 5)(11, \"img\", 6);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(12, \"ion-row\", 7)(13, \"ion-col\", 8)(14, \"ion-text\", 9)(15, \"p\", 10)(16, \"b\");\n        i0.ɵɵtext(17, \"Completa los campos:\");\n        i0.ɵɵelementEnd()()()()();\n        i0.ɵɵelementStart(18, \"ion-row\", 11)(19, \"ion-col\", 12)(20, \"ion-list\", 13)(21, \"ion-item\")(22, \"ion-label\", 14);\n        i0.ɵɵelement(23, \"ion-icon\", 15);\n        i0.ɵɵtext(24, \" Contrase\\u00F1a \");\n        i0.ɵɵelementStart(25, \"ion-text\", 16)(26, \"span\");\n        i0.ɵɵtext(27, \"(Actual)\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelement(28, \"ion-input\", 17);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(29, CambioPassPage_ng_container_29_Template, 2, 1, \"ng-container\", 18);\n        i0.ɵɵelementStart(30, \"div\", 19)(31, \"ion-item\")(32, \"ion-label\", 14);\n        i0.ɵɵelement(33, \"ion-icon\", 15);\n        i0.ɵɵtext(34, \" Nueva Contrase\\u00F1a \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(35, \"ion-input\", 20);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(36, CambioPassPage_ng_container_36_Template, 2, 1, \"ng-container\", 21);\n        i0.ɵɵelementStart(37, \"ion-item\")(38, \"ion-label\", 14);\n        i0.ɵɵelement(39, \"ion-icon\", 15);\n        i0.ɵɵtext(40, \" Nueva Contrase\\u00F1a \");\n        i0.ɵɵelementStart(41, \"ion-text\", 16)(42, \"span\");\n        i0.ɵɵtext(43, \"(Confirma)\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelement(44, \"ion-input\", 22);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(45, CambioPassPage_ng_container_45_Template, 2, 1, \"ng-container\", 18);\n        i0.ɵɵtemplate(46, CambioPassPage_ng_container_46_Template, 2, 1, \"ng-container\", 18);\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(47, \"ion-row\", 23)(48, \"ion-col\", 24)(49, \"ion-button\", 25);\n        i0.ɵɵelement(50, \"ion-icon\", 26);\n        i0.ɵɵtext(51, \" Cambiar \");\n        i0.ɵɵelementEnd()()()()()();\n        i0.ɵɵtemplate(52, CambioPassPage_ion_footer_52_Template, 9, 0, \"ion-footer\", 27);\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(7);\n        i0.ɵɵproperty(\"formGroup\", ctx.cambioPassForm);\n        i0.ɵɵadvance(22);\n        i0.ɵɵproperty(\"ngForOf\", ctx.validation_messages.passwordO);\n        i0.ɵɵadvance(7);\n        i0.ɵɵproperty(\"ngForOf\", ctx.validation_messages.passwordN);\n        i0.ɵɵadvance(9);\n        i0.ɵɵproperty(\"ngForOf\", ctx.validation_messages.passwordNC);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngForOf\", ctx.validation_messages.matching_passwords);\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"ngIf\", ctx.isKeyboardHide);\n      }\n    },\n    directives: [i2.IonHeader, i2.IonToolbar, i2.IonButtons, i2.IonBackButton, i2.IonBackButtonDelegate, i2.IonTitle, i2.IonContent, i3.ɵNgNoValidate, i3.NgControlStatusGroup, i3.FormGroupDirective, i2.IonGrid, i2.IonRow, i2.IonCol, i2.IonText, i2.IonList, i2.IonItem, i2.IonLabel, i2.IonIcon, i2.IonInput, i2.TextValueAccessor, i3.NgControlStatus, i3.FormControlName, i3.RequiredValidator, i5.NgForOf, i5.NgIf, i3.FormGroupName, i2.IonButton, i2.IonFooter],\n    styles: [\"\"]\n  });\n  return CambioPassPage;\n})();","map":null,"metadata":{},"sourceType":"module"}